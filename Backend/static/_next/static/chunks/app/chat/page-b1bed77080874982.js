(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{2431:function(){},4966:function(e,t,r){Promise.resolve().then(r.bind(r,4731))},4731:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var s=r(7437),n=r(2265),a=r(2869),o=r(4508);let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});l.displayName="Textarea";var i=r(6255);let c=n.forwardRef((e,t)=>{let{className:r,children:n,...a}=e;return(0,s.jsxs)(i.fC,{ref:t,className:(0,o.cn)("relative overflow-hidden",r),...a,children:[(0,s.jsx)(i.l_,{className:"h-full w-full rounded-[inherit]",children:n}),(0,s.jsx)(d,{}),(0,s.jsx)(i.Ns,{})]})});c.displayName=i.fC.displayName;let d=n.forwardRef((e,t)=>{let{className:r,orientation:n="vertical",...a}=e;return(0,s.jsx)(i.gb,{ref:t,orientation:n,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...a,children:(0,s.jsx)(i.q4,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=i.gb.displayName;var u=r(8293),h=r(8623),g=r(1706),f=r(3113),m=r(1641),p=r(8662),x=r(4743),b=r(7992),v=r(4131),w=r(6600);function y(){let[e,t]=(0,n.useState)([]),[r,o]=(0,n.useState)(""),[i,d]=(0,n.useState)(!1),[y,j]=(0,n.useState)(["Conversation1"]),[N,S]=(0,n.useState)(null),[k,C]=(0,n.useState)(null),[R,T]=(0,n.useState)(!1),{toast:z}=(0,b.pm)(),A=(0,n.useRef)(null),E=(0,n.useRef)(null),O=(0,n.useRef)(null),_=(0,n.useRef)(null),D=(0,n.useRef)(null),[U,I]=(0,n.useState)([]),[L,M]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=v.Z.get("access");async function r(){try{let r=await fetch("/api/chat-history/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),s=await r.json();t(s)}catch(e){console.error("Error loading chat history:",e)}}e?r():w.default.push("/login")},[]),(0,n.useEffect)(()=>{let e=new WebSocket("wss://5e75-2409-40f2-3013-7583-b73a-d6e8-629-5345.ngrok-free.app/ws/chat/");return D.current=e,e.onopen=()=>{console.log("WebSocket connection established.")},e.onmessage=e=>{console.log("Message received from server:",e.data);try{let r=JSON.parse(e.data),s={id:Date.now(),content:r.message,isUser:!1,timestamp:new Date};t(e=>[...e,s])}catch(e){console.error("Failed to parse message:",e)}},e.onerror=e=>{console.error("WebSocket error:",e)},e.onclose=e=>{console.error("WebSocket connection closed:",e)},()=>{console.log("Closing WebSocket connection"),e.close()}},[]),(0,n.useEffect)(()=>{E.current&&(E.current.scrollTop=E.current.scrollHeight),_.current=window.speechSynthesis},[e]);let Z=async()=>{if(r.trim()||U.length>0){let s=[];if(U.length>0)for(let e of U){let t=await new Promise(t=>{let r=new FileReader;r.onloadend=()=>{t(r.result.replace(/^data:image\/\w+;base64,/,""))},r.readAsDataURL(e.file)});s.push(t)}if(t([...e,{id:Date.now(),content:r,isUser:!0,timestamp:new Date,images:s.length>0?s:void 0}]),o(""),I([]),D.current){let e={message:r,...s.length>0&&{image_url:s}};D.current.send(JSON.stringify(e))}}},P=e=>{I(t=>{let r=[...t];return URL.revokeObjectURL(r[e].preview),r.splice(e,1),r})},W=()=>{if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){let e=window.SpeechRecognition||window.webkitSpeechRecognition;O.current=new e,O.current.continuous=!0,O.current.interimResults=!0,O.current.onresult=e=>{let t="",r="";for(let s=e.resultIndex;s<e.results.length;s++){let n=e.results[s][0].transcript;e.results[s].isFinal?t+=n+" ":r+=n}t?(o(e=>e+t),M("")):M(r)},O.current.onerror=e=>{console.error("Speech recognition error",e.error),V()},O.current.start(),d(!0),z({title:"Recording started",description:"Speak now..."})}else z({title:"Speech Recognition Not Supported",description:"Your browser doesn't support speech recognition.",variant:"destructive"})},V=()=>{O.current&&(O.current.stop(),d(!1),z({title:"Recording stopped",description:"Speech converted to text."}))},B=()=>{let e="Conversation ".concat(y.length+1);j([...y,e]),S(e),t([])},F=e=>{S(e),t([]),T(!1)},J=(e,t)=>{if(_.current){if(k===e)_.current.cancel(),C(null);else{_.current.cancel();let r=new SpeechSynthesisUtterance(t);r.onend=()=>C(null),_.current.speak(r),C(e)}}};return(0,s.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,s.jsxs)("div",{className:"hidden md:block w-72 bg-white p-4 border-r border-gray-200 shadow-md rounded-l-3xl",children:[(0,s.jsx)(a.z,{onClick:B,className:"w-full mb-4 bg-blue-600 text-white rounded-lg shadow-md  hover:bg-blue-500 ",children:"New Conversation"}),(0,s.jsx)(c,{className:"h-[calc(100vh-8rem)]",children:y.map((e,t)=>(0,s.jsx)(a.z,{variant:N===e?"secondary":"ghost",className:"w-full justify-start mb-2 text-gray-800 rounded-lg ".concat(N===e?"bg-blue-100 text-blue-700":"bg-gray-100","hover:bg-gray-100"),onClick:()=>F(e),children:e},t))})]}),R&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 md:hidden",onClick:()=>T(!1),children:(0,s.jsxs)("div",{className:"w-72 h-full bg-white p-4 shadow-lg rounded-r-3xl",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)(a.z,{onClick:B,className:"w-full mb-4 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-500",children:"New Conversation"}),(0,s.jsx)(c,{className:"h-[calc(100vh-8rem)]",children:y.map((e,t)=>(0,s.jsx)(a.z,{variant:N===e?"secondary":"ghost",className:"w-full justify-start mb-2 text-gray-800 rounded-lg ".concat(N===e?"bg-blue-100 text-blue-700":"bg-gray-100"),onClick:()=>F(e),children:e},t))})]})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col w-full",children:[(0,s.jsxs)("div",{className:"md:hidden flex items-center p-4 border-b border-gray-200 bg-white shadow-md",children:[(0,s.jsx)(a.z,{variant:"ghost",size:"sm",onClick:()=>T(!0),className:"mr-2",children:(0,s.jsx)(u.Z,{className:"h-5 w-5 text-gray-600"})}),(0,s.jsx)("h1",{className:"text-lg font-semibold text-gray-800",children:N||"Chat"})]}),(0,s.jsx)(c,{className:"flex-1 p-4 md:p-6 space-y-4",ref:E,children:e.map(e=>(0,s.jsx)("div",{className:"flex ".concat(e.isUser?"justify-end":"justify-start"," mb-4"),children:(0,s.jsxs)("div",{className:"max-w-[85%] md:max-w-[70%]",children:[(0,s.jsxs)("div",{className:"relative group rounded-3xl px-4 py-3 shadow-md ".concat(e.isUser?"bg-blue-500 text-white":"bg-white border border-gray-200 text-gray-800"),children:[e.content,e.images&&e.images.length>0&&(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:e.images.map((e,t)=>(0,s.jsx)("img",{src:"data:image/jpeg;base64,".concat(e),alt:"Attached ".concat(t+1),className:"max-w-[200px] max-h-[200px] object-contain rounded-lg"},t))}),!e.isUser&&(0,s.jsx)(a.z,{variant:"ghost",size:"sm",className:"absolute -right-12 top-1/2 -translate-y-1/2 hover:bg-white-500",onClick:()=>J(e.id,e.content),children:k===e.id?(0,s.jsx)(h.Z,{className:"h-4 w-4 text-gray-600"}):(0,s.jsx)(g.Z,{className:"h-4 w-4 text-gray-600"})})]}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1 px-1",children:e.timestamp.toLocaleTimeString()})]})},e.id))}),(0,s.jsx)("div",{className:"w-full flex flex-wrap gap-2 mb-2",children:U.map((e,t)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("img",{src:e.preview,alt:"Preview",className:"h-16 w-16 object-cover rounded-lg border border-gray-200"}),(0,s.jsx)("button",{onClick:()=>P(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hidden group-hover:block",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},t))}),(0,s.jsx)("div",{className:"p-4 bg-white border-t border-gray-200 shadow-md",children:(0,s.jsxs)("div",{className:"max-w-screen-xl mx-auto flex items-center gap-2",children:[(0,s.jsx)(l,{value:r,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Z())},placeholder:"Type your message...",className:"flex-1 min-h-[50px] max-h-[200px] bg-white text-gray-900 border-gray-200 placeholder:text-gray-500 resize-none rounded-lg shadow-md"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(a.z,{variant:"outline",size:"icon",className:"bg-white hover:bg-gray-300",onClick:()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.click()},children:(0,s.jsx)(f.Z,{className:"h-5 w-5 text-gray-600 "})}),(0,s.jsx)("input",{type:"file",ref:A,onChange:e=>{let t=e.target.files;if(t){let e=Array.from(t).map(e=>({file:e,preview:URL.createObjectURL(e)}));I(t=>[...t,...e])}A.current&&(A.current.value="")},accept:"image/*",className:"hidden "}),(0,s.jsx)(a.z,{variant:"outline",size:"icon",onClick:()=>{i?V():W()},className:"hover:bg-gray-300 ".concat(i?"bg-red-50":"bg-white"),children:i?(0,s.jsx)(m.Z,{className:"h-5 w-5 text-red-500"}):(0,s.jsx)(p.Z,{className:"h-5 w-5 text-gray-600 "})}),(0,s.jsx)(a.z,{size:"icon",onClick:Z,className:"bg-blue-600 text-white rounded-full hover:bg-blue-600 ",children:(0,s.jsx)(x.Z,{className:"h-5 w-5"})})]})]})})]})]})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7437),n=r(2265),a=r(7053),o=r(7712),l=r(4508);let i=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:c=!1,...d}=e,u=c?a.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(i({variant:n,size:o,className:r})),ref:t,...d})});c.displayName="Button"},7992:function(e,t,r){"use strict";r.d(t,{pm:function(){return h}});var s=r(2265);let n=0,a=new Map,o=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?o(r):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(n=(n+1)%Number.MAX_VALUE).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function h(){let[e,t]=s.useState(c);return s.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(1994),n=r(3335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}}},function(e){e.O(0,[466,600,727,971,117,744],function(){return e(e.s=4966)}),_N_E=e.O()}]);